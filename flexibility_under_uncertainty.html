

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Flexibility under Uncertainty &#8212; Rangekeeper</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'flexibility_under_uncertainty';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Loading a Design Scenario" href="load_design_scenario.html" />
    <link rel="prev" title="Introduction to Modeling Flexibility" href="flexibility_intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/rangekeeper.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/rangekeeper.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Rangekeeper
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Real Estate Flexibility and Valuation under Uncertainty</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="basic_dcf.html">A Basic Discounted Cash Flow Valuation</a></li>
<li class="toctree-l1"><a class="reference internal" href="deterministic_scenarios.html">Deterministic Scenario Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="market_dynamics.html">Real Estate Pricing Factor Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="flexibility_intro.html">Introduction to Modeling Flexibility</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Flexibility under Uncertainty</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using Rangekeeper in Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="load_design_scenario.html">Loading a Design Scenario</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/daniel-fink/rangekeeper" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/daniel-fink/rangekeeper/issues/new?title=Issue%20on%20page%20%2Fflexibility_under_uncertainty.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/flexibility_under_uncertainty.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Flexibility under Uncertainty</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-market-scenarios">Multiple Market Scenarios</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#market-parameters-from-sampling-distributions-of-their-likelihoods">Market Parameters from Sampling Distributions of their Likelihoods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#overall-trend">Overall Trend</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#volatility">Volatility</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cyclicality">Cyclicality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#noise-black-swan">Noise &amp; Black Swan</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#markets">Markets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-models">Comparing Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inflexible-base-model">Inflexible (Base) Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flexible-model">Flexible Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-0-present-values-at-occ">Time 0 Present Values at OCC</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pvs-cumulative-distribution-target-curves">PVs Cumulative Distribution (‘Target Curves’)</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#realized-irr-at-market-value-price">Realized IRR at Market Value Price</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#irrs-cumulative-distribution-target-curves">IRRs Cumulative Distribution (‘Target Curves’)</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#irrs-x-pvs">IRRs x PVs</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#inflexible-model">Inflexible Model</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Flexible Model</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvs-diffs">PVs Diffs</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pv-difference-as-a-function-of-inflex-pv">PV Difference as a function of Inflex PV</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#irr-difference-as-a-function-of-inflex-irr">IRR Difference as a function of Inflex IRR</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="flexibility-under-uncertainty">
<h1>Flexibility under Uncertainty<a class="headerlink" href="#flexibility-under-uncertainty" title="Permalink to this heading">#</a></h1>
<p>The previous chapter only modelled a single scenario where flexibility was
employed. In this chapter, we follow <span id="id1">[<a class="reference internal" href="intro.html#id2" title="R. de Neufville and D. Geltner. Flexibility and Real Estate Valuation under Uncertainty: A Practical Guide for Developers. John Wiley &amp; Sons, Ltd, 2018. ISBN 9781119106470. URL: https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119106470, arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781119106470, doi:https://doi.org/10.1002/9781119106470.">dNG18</a>]</span> (Chapter 9) in
assessing how flexibility can be used to manage, and benefit from, uncertainty.</p>
<section id="multiple-market-scenarios">
<h2>Multiple Market Scenarios<a class="headerlink" href="#multiple-market-scenarios" title="Permalink to this heading">#</a></h2>
<p>If we can produce one future market scenario, we can also produce many. To
incorporate our uncertainty about how future scenarios may unfold, we derive
<code class="docutils literal notranslate"><span class="pre">Market</span></code> input parameters by sampling from probability distributions that
we suspect are realistic for the market in question.</p>
<section id="market-parameters-from-sampling-distributions-of-their-likelihoods">
<h3>Market Parameters from Sampling Distributions of their Likelihoods<a class="headerlink" href="#market-parameters-from-sampling-distributions-of-their-likelihoods" title="Permalink to this heading">#</a></h3>
<p><em>Rangekeeper</em> provides alternate methods for <code class="docutils literal notranslate"><span class="pre">Market</span></code> <code class="docutils literal notranslate"><span class="pre">dynamics</span></code> modules that
take probability distributions as inputs, rather than single values. These
methods also require us to specify how many iterations (runs, or simulations) we
will produce.</p>
<p>Begin with importing required libraries and configuring our context:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">rangekeeper</span> <span class="k">as</span> <span class="nn">rk</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;en_au&#39;</span><span class="p">)</span>
<span class="n">units</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">registry</span>
<span class="n">currency</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">register_currency</span><span class="p">(</span><span class="n">registry</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Specify how many iterations (scenarios) we will produce. This matches the number
of samples we will take from the probability distributions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">2000</span>
</pre></div>
</div>
</div>
</div>
<p>We also need to define the overall <code class="docutils literal notranslate"><span class="pre">Span</span></code> of the <code class="docutils literal notranslate"><span class="pre">Market</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">period_type</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">periodicity</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">YEAR</span>
<span class="n">span</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">Span</span><span class="o">.</span><span class="n">from_num_periods</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Span&quot;</span><span class="p">,</span>
    <span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">period_type</span><span class="o">=</span><span class="n">period_type</span><span class="p">,</span>
    <span class="n">num_periods</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">sequence</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">to_index</span><span class="p">(</span><span class="n">period_type</span><span class="o">=</span><span class="n">period_type</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="overall-trend">
<h4>Overall Trend<a class="headerlink" href="#overall-trend" title="Permalink to this heading">#</a></h4>
<p>Following how <span id="id2">[<a class="reference internal" href="intro.html#id2" title="R. de Neufville and D. Geltner. Flexibility and Real Estate Valuation under Uncertainty: A Practical Guide for Developers. John Wiley &amp; Sons, Ltd, 2018. ISBN 9781119106470. URL: https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119106470, arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781119106470, doi:https://doi.org/10.1002/9781119106470.">dNG18</a>]</span> construct market simulations, a <em>Rangekeeper</em>
<code class="docutils literal notranslate"><span class="pre">Market</span></code> <code class="docutils literal notranslate"><span class="pre">Trend</span></code> can sample from distributions defining the growth rate (trend)
and initial rent value.</p>
<p>For initial (rent) value, typically values would not be more than 0.05 or 0.1,
at most. Initial rents should be able to be estimated pretty accurately in the
realistic pro-forma, especially for existing buildings.</p>
<p>The growth rate distribution reflects uncertainty in the long-run trend growth
rate (that applies throughout the entire scenario. In <span id="id3">[<a class="reference internal" href="intro.html#id2" title="R. de Neufville and D. Geltner. Flexibility and Real Estate Valuation under Uncertainty: A Practical Guide for Developers. John Wiley &amp; Sons, Ltd, 2018. ISBN 9781119106470. URL: https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119106470, arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781119106470, doi:https://doi.org/10.1002/9781119106470.">dNG18</a>]</span>, this
is modeled as a triangular distribution (though <em>Rangekeeper</em> provides other
distributions easily), and the half-range should typically be a small value, at
most .01 or .02, unless there is great uncertainty in the long-run average
growth rate in the economy (such as perhaps in some emerging market countries),
or if one is modeling nominal values and there is great uncertainty about what
the future rate of inflation will be (but in such cases it is better to model
real values, net of inflation anyway).</p>
<p>(From <span id="id4">[<a class="reference internal" href="intro.html#id2" title="R. de Neufville and D. Geltner. Flexibility and Real Estate Valuation under Uncertainty: A Practical Guide for Developers. John Wiley &amp; Sons, Ltd, 2018. ISBN 9781119106470. URL: https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119106470, arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781119106470, doi:https://doi.org/10.1002/9781119106470.">dNG18</a>]</span>, accompanying Excel spreadsheets)</p>
<p>First we define the distributions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">growth_rate_dist</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">TRIANGULAR</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=-</span><span class="mf">.0005</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mf">.005</span><span class="p">)</span>
<span class="n">initial_value_dist</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">TRIANGULAR</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mf">.005</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We now produce the resultant <code class="docutils literal notranslate"><span class="pre">Trend</span></code>s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cap_rate</span> <span class="o">=</span> <span class="mf">.05</span>

<span class="n">trends</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">dynamics</span><span class="o">.</span><span class="n">trend</span><span class="o">.</span><span class="n">Trend</span><span class="o">.</span><span class="n">from_likelihoods</span><span class="p">(</span>
    <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
    <span class="n">cap_rate</span><span class="o">=</span><span class="n">cap_rate</span><span class="p">,</span>
    <span class="n">growth_rate_dist</span><span class="o">=</span><span class="n">growth_rate_dist</span><span class="p">,</span>
    <span class="n">initial_value_dist</span><span class="o">=</span><span class="n">initial_value_dist</span><span class="p">,</span>
    <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can check that the <code class="docutils literal notranslate"><span class="pre">Trend</span></code>s have been produced as expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">trend</span><span class="o">.</span><span class="n">initial_value</span> <span class="k">for</span> <span class="n">trend</span> <span class="ow">in</span> <span class="n">trends</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">initial_values</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="_images/26dac58151f53547343f500019141be36749a12cf514f8e41ba8954fa1f4d2eb.png" src="_images/26dac58151f53547343f500019141be36749a12cf514f8e41ba8954fa1f4d2eb.png" />
</div>
</div>
</section>
<section id="volatility">
<h4>Volatility<a class="headerlink" href="#volatility" title="Permalink to this heading">#</a></h4>
<p>Volatility inputs do not require sampling from distributions, but we will be
producing multiple <code class="docutils literal notranslate"><span class="pre">Volatility</span></code> objects, one for each <code class="docutils literal notranslate"><span class="pre">Trend</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">volatility_per_period</span> <span class="o">=</span> <span class="mf">.1</span>
<span class="n">autoregression_param</span> <span class="o">=</span> <span class="mf">.2</span>
<span class="n">mean_reversion_param</span> <span class="o">=</span> <span class="mf">.3</span>

<span class="n">volatilities</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">dynamics</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">Volatility</span><span class="o">.</span><span class="n">from_trends</span><span class="p">(</span>
    <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
    <span class="n">trends</span><span class="o">=</span><span class="n">trends</span><span class="p">,</span>
    <span class="n">volatility_per_period</span><span class="o">=</span><span class="n">volatility_per_period</span><span class="p">,</span>
    <span class="n">autoregression_param</span><span class="o">=</span><span class="n">autoregression_param</span><span class="p">,</span>
    <span class="n">mean_reversion_param</span><span class="o">=</span><span class="n">mean_reversion_param</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cyclicality">
<h4>Cyclicality<a class="headerlink" href="#cyclicality" title="Permalink to this heading">#</a></h4>
<p><span id="id5">[<a class="reference internal" href="intro.html#id2" title="R. de Neufville and D. Geltner. Flexibility and Real Estate Valuation under Uncertainty: A Practical Guide for Developers. John Wiley &amp; Sons, Ltd, 2018. ISBN 9781119106470. URL: https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119106470, arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781119106470, doi:https://doi.org/10.1002/9781119106470.">dNG18</a>]</span> document multiple means to incorporate estimations of market
cycle parameters into a market simulation. Here we replicate the distribution
parameters for use in <em>Rangekeeper</em>.</p>
<p>We are agnostic about where the market currently is in the cycle, and want
to simulate all possibilities; thus the Space (Rent) Cycle Phase Proportion (of
its period) is sampled from a uniform distribution defaulted to a range between
0 &amp; 1):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space_cycle_phase_prop_dist</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Uniform</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The Space (Rent) Cycle Period is a random sample between 10 &amp; 20 years:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space_cycle_period_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">UNIFORM</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Space (Rent) Cycle peak-to-trough Height is set at 50% (see <code class="docutils literal notranslate"><span class="pre">residual</span></code> fixed
to 0):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space_cycle_height_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">UNIFORM</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Asset (Cap Rate) Cycle Phase differs from the Space Cycle by between -1/10th
and 1/10th of the Space Cycle Period:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asset_cycle_phase_diff_prop_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">UNIFORM</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Asset (Cap Rate) Cycle Period in between -1 and 1 year different to that of
the Space (Rent) Cycle’s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asset_cycle_period_diff_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">UNIFORM</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Asset (Cap Rate) Cycle Amplitude is fixed to 2%:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asset_cycle_amplitude_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">UNIFORM</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mf">.02</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For both the Space and Asset Cycles, we remove any cycle asymmetries, in order
to align with <span id="id6">[<a class="reference internal" href="intro.html#id2" title="R. de Neufville and D. Geltner. Flexibility and Real Estate Valuation under Uncertainty: A Practical Guide for Developers. John Wiley &amp; Sons, Ltd, 2018. ISBN 9781119106470. URL: https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119106470, arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781119106470, doi:https://doi.org/10.1002/9781119106470.">dNG18</a>]</span>’s spreadsheet for Chapters 8, 9, 10. In future
classes (and possibly future editions), they incorporate cycle asymmetries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space_cycle_asymmetric_parameter_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">UNIFORM</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">asset_cycle_asymmetric_parameter_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">UNIFORM</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">residual</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We now produce the resultant <code class="docutils literal notranslate"><span class="pre">Cycle</span></code>s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cyclicalities</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">dynamics</span><span class="o">.</span><span class="n">cyclicality</span><span class="o">.</span><span class="n">Cyclicality</span><span class="o">.</span><span class="n">from_likelihoods</span><span class="p">(</span>
    <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
    <span class="n">space_cycle_phase_prop_dist</span><span class="o">=</span><span class="n">space_cycle_phase_prop_dist</span><span class="p">,</span>
    <span class="n">space_cycle_period_dist</span><span class="o">=</span><span class="n">space_cycle_period_dist</span><span class="p">,</span>
    <span class="n">space_cycle_height_dist</span><span class="o">=</span><span class="n">space_cycle_height_dist</span><span class="p">,</span>
    <span class="n">asset_cycle_phase_diff_prop_dist</span><span class="o">=</span><span class="n">asset_cycle_phase_diff_prop_dist</span><span class="p">,</span>
    <span class="n">asset_cycle_period_diff_dist</span><span class="o">=</span><span class="n">asset_cycle_period_diff_dist</span><span class="p">,</span>
    <span class="n">asset_cycle_amplitude_dist</span><span class="o">=</span><span class="n">asset_cycle_amplitude_dist</span><span class="p">,</span>
    <span class="n">space_cycle_asymmetric_parameter_dist</span><span class="o">=</span><span class="n">space_cycle_asymmetric_parameter_dist</span><span class="p">,</span>
    <span class="n">asset_cycle_asymmetric_parameter_dist</span><span class="o">=</span><span class="n">asset_cycle_asymmetric_parameter_dist</span><span class="p">,</span>
    <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="noise-black-swan">
<h4>Noise &amp; Black Swan<a class="headerlink" href="#noise-black-swan" title="Permalink to this heading">#</a></h4>
<p>Noise &amp; Black Swan inputs do not require sampling from distributions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">dynamics</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">Noise</span><span class="p">(</span>
    <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
    <span class="n">noise_dist</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Symmetric</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">TRIANGULAR</span><span class="p">,</span>
        <span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">residual</span><span class="o">=</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">black_swan</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">dynamics</span><span class="o">.</span><span class="n">black_swan</span><span class="o">.</span><span class="n">BlackSwan</span><span class="p">(</span>
    <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
    <span class="n">likelihood</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span>
    <span class="n">dissipation_rate</span><span class="o">=</span><span class="n">mean_reversion_param</span><span class="p">,</span>
    <span class="n">probability</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(),</span>
    <span class="n">impact</span><span class="o">=-</span><span class="mf">.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="markets">
<h3>Markets<a class="headerlink" href="#markets" title="Permalink to this heading">#</a></h3>
<p>Now we can integrate the previous constructs into multiple <code class="docutils literal notranslate"><span class="pre">Market</span></code> simulations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">markets</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">dynamics</span><span class="o">.</span><span class="n">market</span><span class="o">.</span><span class="n">Market</span><span class="o">.</span><span class="n">from_likelihoods</span><span class="p">(</span>
    <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
    <span class="n">trends</span><span class="o">=</span><span class="n">trends</span><span class="p">,</span>
    <span class="n">volatilities</span><span class="o">=</span><span class="n">volatilities</span><span class="p">,</span>
    <span class="n">cyclicalities</span><span class="o">=</span><span class="n">cyclicalities</span><span class="p">,</span>
    <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
    <span class="n">black_swan</span><span class="o">=</span><span class="n">black_swan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="comparing-models">
<h2>Comparing Models<a class="headerlink" href="#comparing-models" title="Permalink to this heading">#</a></h2>
<p>From <span id="id7">[<a class="reference internal" href="intro.html#id2" title="R. de Neufville and D. Geltner. Flexibility and Real Estate Valuation under Uncertainty: A Practical Guide for Developers. John Wiley &amp; Sons, Ltd, 2018. ISBN 9781119106470. URL: https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119106470, arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781119106470, doi:https://doi.org/10.1002/9781119106470.">dNG18</a>]</span>: to obtain the value of flexibility, we compare the
project utilizing flexibility against a base case or alternative that lacks the
particular flexibility or rule we are evaluating.
We must expose the inflexible case to the same independent, random future
scenarios as the flexible case. We must compute the outcomes for the two cases,
inflexible and flexible, under exactly the same scenarios of pricing factor
realizations. We can then compare the results of both the inflexible and
flexible cases, not only against the (single‐number) traditional pro forma
metrics, but also side by side against each other for the entire distribution of
possible (ex‐post) outcomes, recognizing the uncertainty and price dynamics that
realistically exist.</p>
<section id="inflexible-base-model">
<h3>Inflexible (Base) Model<a class="headerlink" href="#inflexible-base-model" title="Permalink to this heading">#</a></h3>
<p>Define the Base Model as we did the Ex-Post Inflexible Model in the previous
section:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;start_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2001-01-01&#39;</span><span class="p">),</span>
    <span class="s1">&#39;num_periods&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;period_type&#39;</span><span class="p">:</span> <span class="n">rk</span><span class="o">.</span><span class="n">periodicity</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">YEAR</span><span class="p">,</span>
    <span class="s1">&#39;acquisition_cost&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
    <span class="s1">&#39;initial_income&#39;</span><span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
    <span class="s1">&#39;growth_rate&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>
    <span class="s1">&#39;vacancy_rate&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="s1">&#39;opex_pgi_ratio&#39;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span>
    <span class="s1">&#39;capex_pgi_ratio&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s1">&#39;exit_caprate&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="s1">&#39;discount_rate&#39;</span><span class="p">:</span> <span class="mf">0.07</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
    <span class="k">def</span> <span class="nf">set_market</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">:</span> <span class="n">rk</span><span class="o">.</span><span class="n">dynamics</span><span class="o">.</span><span class="n">market</span><span class="o">.</span><span class="n">Market</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market</span> <span class="o">=</span> <span class="n">market</span>
    <span class="k">def</span> <span class="nf">init_spans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_span</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">Span</span><span class="o">.</span><span class="n">from_num_periods</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Span to Calculate Reversion&#39;</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">],</span>
            <span class="n">num_periods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;num_periods&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acq_span</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">Span</span><span class="o">.</span><span class="n">from_num_periods</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Acquisition Span&#39;</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">periodicity</span><span class="o">.</span><span class="n">offset_date</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span>
                <span class="n">num_periods</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">]),</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">],</span>
            <span class="n">num_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_span</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Span&#39;</span><span class="p">,</span>
            <span class="n">num_periods</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">],</span>
            <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reversion_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reversion Span&#39;</span><span class="p">,</span>
            <span class="n">num_periods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;num_periods&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">],</span>
            <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;start&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">calc_acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="o">.</span><span class="n">from_projection</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Acquisition&#39;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;acquisition_cost&#39;</span><span class="p">],</span>
            <span class="n">proj</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span>
                <span class="n">form</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(),</span>
                <span class="n">sequence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acq_span</span><span class="o">.</span><span class="n">to_index</span><span class="p">(</span><span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">calc_egi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pgi</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="o">.</span><span class="n">from_projection</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Potential Gross Income&#39;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;initial_income&#39;</span><span class="p">],</span>
            <span class="n">proj</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">Extrapolation</span><span class="p">(</span>
                <span class="n">form</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">extrapolation</span><span class="o">.</span><span class="n">Compounding</span><span class="p">(</span>
                    <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">]),</span>
                <span class="n">sequence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_span</span><span class="o">.</span><span class="n">to_index</span><span class="p">(</span><span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

        <span class="c1"># Construct a Stream that multiplies the Base Model&#39;s PGI by the</span>
        <span class="c1"># simulated Market&#39;s Space Market factors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgi</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Potential Gross Income&#39;</span><span class="p">,</span>
            <span class="n">flows</span><span class="o">=</span><span class="p">[</span>
                <span class="n">pgi</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">market</span><span class="o">.</span><span class="n">space_market_price_factors</span><span class="o">.</span><span class="n">trim_to_span</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_span</span><span class="p">)</span>
                <span class="p">],</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">registry</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vacancy</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Vacancy Allowance&#39;</span><span class="p">,</span>
            <span class="n">movements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pgi</span><span class="o">.</span><span class="n">movements</span> <span class="o">*</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;vacancy_rate&#39;</span><span class="p">],</span>
            <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">egi</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Effective Gross Income&#39;</span><span class="p">,</span>
            <span class="n">flows</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pgi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacancy</span><span class="p">],</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">calc_noi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opex</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Operating Expenses&#39;</span><span class="p">,</span>
            <span class="n">movements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pgi</span><span class="o">.</span><span class="n">movements</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;opex_pgi_ratio&#39;</span><span class="p">],</span>
            <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noi</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Net Operating Income&#39;</span><span class="p">,</span>
            <span class="n">flows</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">egi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opex</span><span class="p">],</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">calc_ncf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capex</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Capital Expenditures&#39;</span><span class="p">,</span>
            <span class="n">movements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pgi</span><span class="o">.</span><span class="n">movements</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;capex_pgi_ratio&#39;</span><span class="p">],</span>
            <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net_cf</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Net Annual Cashflow&#39;</span><span class="p">,</span>
            <span class="n">flows</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">noi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">capex</span><span class="p">],</span>
            <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">calc_reversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Construct the Reversions using the simulated Market&#39;s Asset Market</span>
            <span class="c1"># factors (cap rates):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reversions</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reversions&#39;</span><span class="p">,</span>
                <span class="n">movements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">net_cf</span><span class="o">.</span><span class="n">movements</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="o">/</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">market</span><span class="o">.</span><span class="n">implied_rev_cap_rate</span><span class="o">.</span><span class="n">movements</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">trim_to_span</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">reversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversions</span><span class="o">.</span><span class="n">trim_to_span</span><span class="p">(</span>
                <span class="n">span</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reversion_span</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reversion&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbtcfs</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;PBTCFs&#39;</span><span class="p">,</span>
                <span class="n">flows</span><span class="o">=</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">net_cf</span><span class="o">.</span><span class="n">trim_to_span</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reversions</span><span class="o">.</span><span class="n">trim_to_span</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reversion_span</span><span class="p">)</span>
                    <span class="p">],</span>
                <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">calc_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pvs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">irrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_cf</span><span class="o">.</span><span class="n">trim_to_span</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="p">)</span><span class="o">.</span><span class="n">movements</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">cumulative_net_cf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_cf</span><span class="o">.</span><span class="n">trim_to_span</span><span class="p">(</span>
                <span class="n">span</span><span class="o">=</span><span class="n">rk</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">Span</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cumulative Net Cashflow Span&#39;</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">period</span><span class="p">))</span>
            <span class="n">reversion</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span>
                <span class="n">movements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reversions</span><span class="o">.</span><span class="n">movements</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">period</span><span class="p">]],</span>
                <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
            <span class="n">cumulative_net_cf_with_rev</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Net Cashflow with Reversion&#39;</span><span class="p">,</span>
                <span class="n">flows</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">cumulative_net_cf</span><span class="p">,</span>
                    <span class="n">reversion</span>
                    <span class="p">],</span>
                <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])</span>
            <span class="n">pv</span> <span class="o">=</span> <span class="n">cumulative_net_cf_with_rev</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">pv</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Present Value&#39;</span><span class="p">,</span>
                <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">],</span>
                <span class="n">discount_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;discount_rate&#39;</span><span class="p">])</span>
            <span class="n">pvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pv</span><span class="o">.</span><span class="n">collapse</span><span class="p">()</span><span class="o">.</span><span class="n">movements</span><span class="p">)</span>

            <span class="n">incl_acq</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Net Cashflow with Reversion and Acquisition&#39;</span><span class="p">,</span>
                <span class="n">flows</span><span class="o">=</span><span class="p">[</span><span class="n">cumulative_net_cf_with_rev</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span><span class="p">],</span>
                <span class="n">period_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period_type&#39;</span><span class="p">])</span>

            <span class="n">irrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">incl_acq</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">xirr</span><span class="p">(),</span> <span class="mi">4</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pvs</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Present Values&#39;</span><span class="p">,</span>
            <span class="n">movements</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pvs</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">currency</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrs</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Internal Rates of Return&#39;</span><span class="p">,</span>
            <span class="n">movements</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">irrs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pvs</span><span class="o">.</span><span class="n">movements</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_spans</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_acquisition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_egi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_noi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_ncf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_reversion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_metrics</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>For each <code class="docutils literal notranslate"><span class="pre">Market</span></code>, we then run the Base Model.
To speed this up we can use multiprocessing, so we need to import and configure
a few libraries:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">multiprocess</span>
<span class="kn">import</span> <span class="nn">pint</span>
<span class="n">pint</span><span class="o">.</span><span class="n">set_application_registry</span><span class="p">(</span><span class="n">rk</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inflex_scenarios</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
    <span class="n">scenario</span> <span class="o">=</span> <span class="n">BaseModel</span><span class="p">()</span>
    <span class="n">scenario</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">scenario</span><span class="o">.</span><span class="n">set_market</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
    <span class="n">inflex_scenarios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">scenario</span><span class="p">):</span>
    <span class="n">scenario</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">scenario</span>
<span class="n">inflex_scenarios</span> <span class="o">=</span> <span class="n">multiprocess</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
    <span class="n">generate</span><span class="p">,</span>
    <span class="n">inflex_scenarios</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="flexible-model">
<h3>Flexible Model<a class="headerlink" href="#flexible-model" title="Permalink to this heading">#</a></h3>
<p>Similarly, we set up the Flexible Model with our <code class="docutils literal notranslate"><span class="pre">Policy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">exceed_pricing_factor</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">rk</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">Flow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">movements</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">movements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">adjust_hold_period</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
        <span class="n">decisions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
    <span class="c1"># Get the index of the decision flag:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">decisions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">decisions</span><span class="p">)</span>

    <span class="c1"># Adjust the Model&#39;s holding period:</span>
    <span class="n">policy_params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">policy_params</span><span class="p">[</span><span class="s1">&#39;num_periods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>

    <span class="c1"># Re-run the Model with updated params:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">policy_params</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="n">stop_gain_resale_policy</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">Policy</span><span class="p">(</span>
    <span class="n">condition</span><span class="o">=</span><span class="n">exceed_pricing_factor</span><span class="p">,</span>
    <span class="n">action</span><span class="o">=</span><span class="n">adjust_hold_period</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And we run the Flexible Model for each <code class="docutils literal notranslate"><span class="pre">Market</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">policy_args</span> <span class="o">=</span> <span class="p">[(</span><span class="n">scenario</span><span class="o">.</span><span class="n">market</span><span class="o">.</span><span class="n">space_market_price_factors</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">inflex_scenarios</span><span class="p">]</span>
<span class="n">flex_scenarios</span> <span class="o">=</span> <span class="n">multiprocess</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
    <span class="n">stop_gain_resale_policy</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span>
    <span class="n">policy_args</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="results">
<h3>Results<a class="headerlink" href="#results" title="Permalink to this heading">#</a></h3>
<p>We can now compare the results of the Base and Flexible Models with some
descriptive statistics</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">ss</span>
</pre></div>
</div>
</div>
</div>
<section id="time-0-present-values-at-occ">
<h4>Time 0 Present Values at OCC<a class="headerlink" href="#time-0-present-values-at-occ" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inflex_pvs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="o">.</span><span class="n">pvs</span><span class="o">.</span><span class="n">movements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">inflex_scenarios</span><span class="p">])</span>
<span class="n">flex_pvs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="o">.</span><span class="n">pvs</span><span class="o">.</span><span class="n">movements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">flex_scenarios</span><span class="p">])</span>
<span class="n">diff_pvs</span> <span class="o">=</span> <span class="n">flex_pvs</span> <span class="o">-</span> <span class="n">inflex_pvs</span>

<span class="n">pvs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Inflexible&#39;</span><span class="p">:</span> <span class="n">inflex_pvs</span><span class="p">,</span>
    <span class="s1">&#39;Flexible&#39;</span><span class="p">:</span> <span class="n">flex_pvs</span><span class="p">,</span>
    <span class="s1">&#39;Difference&#39;</span><span class="p">:</span> <span class="n">diff_pvs</span><span class="p">})</span>
<span class="n">pvs</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inflexible</th>
      <th>Flexible</th>
      <th>Difference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2000.000000</td>
      <td>2000.000000</td>
      <td>2000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1077.160944</td>
      <td>1455.314314</td>
      <td>378.153370</td>
    </tr>
    <tr>
      <th>std</th>
      <td>343.038479</td>
      <td>414.143476</td>
      <td>581.899914</td>
    </tr>
    <tr>
      <th>min</th>
      <td>520.212643</td>
      <td>526.275790</td>
      <td>-1241.803631</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>792.222456</td>
      <td>1211.970974</td>
      <td>-23.274504</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>999.837808</td>
      <td>1474.302493</td>
      <td>381.510068</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1312.120455</td>
      <td>1733.074685</td>
      <td>816.263216</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2589.072087</td>
      <td>2599.258993</td>
      <td>1763.820898</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pvs</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inflexible    0.808521
Flexible     -0.273305
Difference   -0.068384
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pvs</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inflexible    0.168793
Flexible     -0.153484
Difference   -0.607734
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PV Diffs t-stat: </span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">ss</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">diff_pvs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PV Diffs t-stat: 
TtestResult(statistic=29.06261441258744, pvalue=3.3881155333083696e-155, df=1999)
</pre></div>
</div>
</div>
</div>
<section id="pvs-cumulative-distribution-target-curves">
<h5>PVs Cumulative Distribution (‘Target Curves’)<a class="headerlink" href="#pvs-cumulative-distribution-target-curves" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">ecdfplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">pvs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Difference&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;Proportion&#39;&gt;
</pre></div>
</div>
<img alt="_images/1f42753066d82cd291085002b35c468e2664533df3524b151452e456aa523af3.png" src="_images/1f42753066d82cd291085002b35c468e2664533df3524b151452e456aa523af3.png" />
</div>
</div>
</section>
</section>
<section id="realized-irr-at-market-value-price">
<h4>Realized IRR at Market Value Price<a class="headerlink" href="#realized-irr-at-market-value-price" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inflex_irrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="o">.</span><span class="n">irrs</span><span class="o">.</span><span class="n">movements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">inflex_scenarios</span><span class="p">])</span>
<span class="n">flex_irrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="o">.</span><span class="n">irrs</span><span class="o">.</span><span class="n">movements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">flex_scenarios</span><span class="p">])</span>
<span class="n">diff_irrs</span> <span class="o">=</span> <span class="n">flex_irrs</span> <span class="o">-</span> <span class="n">inflex_irrs</span>

<span class="n">irrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Inflexible&#39;</span><span class="p">:</span> <span class="n">inflex_irrs</span><span class="p">,</span>
    <span class="s1">&#39;Flexible&#39;</span><span class="p">:</span> <span class="n">flex_irrs</span><span class="p">,</span>
    <span class="s1">&#39;Difference&#39;</span><span class="p">:</span> <span class="n">diff_irrs</span><span class="p">})</span>
<span class="n">irrs</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inflexible</th>
      <th>Flexible</th>
      <th>Difference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2000.000000</td>
      <td>2000.000000</td>
      <td>2000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.071754</td>
      <td>0.306873</td>
      <td>0.235119</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.040384</td>
      <td>0.370640</td>
      <td>0.385589</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.020800</td>
      <td>-0.035200</td>
      <td>-0.167200</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.037775</td>
      <td>0.094175</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.069950</td>
      <td>0.137100</td>
      <td>0.061450</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.104400</td>
      <td>0.336625</td>
      <td>0.290200</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.188900</td>
      <td>1.781200</td>
      <td>1.715400</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">irrs</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inflexible    0.159404
Flexible      1.830991
Difference    1.762029
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">irrs</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inflexible   -0.897433
Flexible      2.286385
Difference    2.063892
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;IRR Diffs t-stat: </span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">ss</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">diff_irrs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>IRR Diffs t-stat: 
TtestResult(statistic=27.26948876633451, pvalue=1.7755863208453303e-139, df=1999)
</pre></div>
</div>
</div>
</div>
<section id="irrs-cumulative-distribution-target-curves">
<h5>IRRs Cumulative Distribution (‘Target Curves’)<a class="headerlink" href="#irrs-cumulative-distribution-target-curves" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">ecdfplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">irrs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Difference&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;Proportion&#39;&gt;
</pre></div>
</div>
<img alt="_images/4971c978084d2c49188ac1e55efb21d04c3e30313f949c02bb519f23ff69441c.png" src="_images/4971c978084d2c49188ac1e55efb21d04c3e30313f949c02bb519f23ff69441c.png" />
</div>
</div>
</section>
</section>
<section id="irrs-x-pvs">
<h4>IRRs x PVs<a class="headerlink" href="#irrs-x-pvs" title="Permalink to this heading">#</a></h4>
<section id="inflexible-model">
<h5>Inflexible Model<a class="headerlink" href="#inflexible-model" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inflex_irr_x_pv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;PV&#39;</span><span class="p">:</span> <span class="n">inflex_pvs</span><span class="p">,</span>
    <span class="s1">&#39;IRR&#39;</span><span class="p">:</span> <span class="n">inflex_irrs</span><span class="p">,})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">inflex_irr_x_pv</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;PV&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;IRR&#39;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x33abd0700&gt;
</pre></div>
</div>
<img alt="_images/03acd1199bea578c53f40b8ab41286a1c87fa7e4a9a611f5465d0ae80696acc4.png" src="_images/03acd1199bea578c53f40b8ab41286a1c87fa7e4a9a611f5465d0ae80696acc4.png" />
</div>
</div>
</section>
<section id="id8">
<h5>Flexible Model<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flex_irr_x_pv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;PV&#39;</span><span class="p">:</span> <span class="n">flex_pvs</span><span class="p">,</span>
    <span class="s1">&#39;IRR&#39;</span><span class="p">:</span> <span class="n">flex_irrs</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">flex_irr_x_pv</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;PV&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;IRR&#39;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x33ad5e200&gt;
</pre></div>
</div>
<img alt="_images/8137e340c27fe8968f0b7d37edeff95d178ae4652b1dd4db80fac0d92061233e.png" src="_images/8137e340c27fe8968f0b7d37edeff95d178ae4652b1dd4db80fac0d92061233e.png" />
</div>
</div>
</section>
</section>
<section id="pvs-diffs">
<h4>PVs Diffs<a class="headerlink" href="#pvs-diffs" title="Permalink to this heading">#</a></h4>
<section id="pv-difference-as-a-function-of-inflex-pv">
<h5>PV Difference as a function of Inflex PV<a class="headerlink" href="#pv-difference-as-a-function-of-inflex-pv" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_pvs_x_inflex_pvs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Inflexible PVs&#39;</span><span class="p">:</span> <span class="n">inflex_pvs</span><span class="p">,</span>
    <span class="s1">&#39;Difference in PV&#39;</span><span class="p">:</span> <span class="n">diff_pvs</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">diff_pvs_x_inflex_pvs</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Inflexible PVs&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Difference in PV&#39;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x33ad61a20&gt;
</pre></div>
</div>
<img alt="_images/78d996bf3c0faf92678bea0e50503dd325df6b2152450c90e6e257a1aaa24b79.png" src="_images/78d996bf3c0faf92678bea0e50503dd325df6b2152450c90e6e257a1aaa24b79.png" />
</div>
</div>
</section>
<section id="irr-difference-as-a-function-of-inflex-irr">
<h5>IRR Difference as a function of Inflex IRR<a class="headerlink" href="#irr-difference-as-a-function-of-inflex-irr" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_irrs_x_inflex_irrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Inflexible IRRs&#39;</span><span class="p">:</span> <span class="n">inflex_irrs</span><span class="p">,</span>
    <span class="s1">&#39;Difference in IRR&#39;</span><span class="p">:</span> <span class="n">diff_irrs</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">diff_irrs_x_inflex_irrs</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Inflexible IRRs&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Difference in IRR&#39;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x33abb56c0&gt;
</pre></div>
</div>
<img alt="_images/87b8eb800decf94d07b7564a030fb339893fd9d37eeea264ce457ede44b897c7.png" src="_images/87b8eb800decf94d07b7564a030fb339893fd9d37eeea264ce457ede44b897c7.png" />
</div>
</div>
</section>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="flexibility_intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to Modeling Flexibility</p>
      </div>
    </a>
    <a class="right-next"
       href="load_design_scenario.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Loading a Design Scenario</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-market-scenarios">Multiple Market Scenarios</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#market-parameters-from-sampling-distributions-of-their-likelihoods">Market Parameters from Sampling Distributions of their Likelihoods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#overall-trend">Overall Trend</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#volatility">Volatility</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cyclicality">Cyclicality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#noise-black-swan">Noise &amp; Black Swan</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#markets">Markets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-models">Comparing Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inflexible-base-model">Inflexible (Base) Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flexible-model">Flexible Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-0-present-values-at-occ">Time 0 Present Values at OCC</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pvs-cumulative-distribution-target-curves">PVs Cumulative Distribution (‘Target Curves’)</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#realized-irr-at-market-value-price">Realized IRR at Market Value Price</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#irrs-cumulative-distribution-target-curves">IRRs Cumulative Distribution (‘Target Curves’)</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#irrs-x-pvs">IRRs x PVs</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#inflexible-model">Inflexible Model</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Flexible Model</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pvs-diffs">PVs Diffs</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pv-difference-as-a-function-of-inflex-pv">PV Difference as a function of Inflex PV</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#irr-difference-as-a-function-of-inflex-irr">IRR Difference as a function of Inflex IRR</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Daniel Fink
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>